<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Productivity Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }

    .container {
      margin: 50px auto;
      max-width: 600px;
    }

    input[type="file"], select {
      padding: 10px;
      margin-bottom: 20px;
    }

    .message {
      margin-top: 20px;
      color: green;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Upload Staff Productivity CSV</h1>

    <!-- CSV File Upload Form -->
    <input type="file" id="fileInput" accept=".csv" />
    <button id="uploadBtn" disabled>Upload CSV</button>

    <!-- Date Range Selection -->
    <div id="dateRangeSection" style="display: none;">
      <h3>Select Date Range</h3>
      <label for="startDate">From:</label>
      <input type="date" id="startDate">
      <label for="endDate">To:</label>
      <input type="date" id="endDate">
      <button id="filterBtn">Apply Filter</button>
    </div>

    <!-- Confirmation Message -->
    <div id="confirmationMessage" class="message"></div>

  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const confirmationMessage = document.getElementById("confirmationMessage");
    const dateRangeSection = document.getElementById("dateRangeSection");
    const startDateInput = document.getElementById("startDate");
    const endDateInput = document.getElementById("endDate");
    const filterBtn = document.getElementById("filterBtn");

    let csvData = [];

    // Enable the upload button when a file is selected
    fileInput.addEventListener("change", function () {
      if (fileInput.files.length > 0) {
        uploadBtn.disabled = false;
      } else {
        uploadBtn.disabled = true;
      }
    });

    // Handle file upload
    uploadBtn.addEventListener("click", function () {
      const file = fileInput.files[0];
      
      if (file.type === "text/csv") {
        const reader = new FileReader();

        reader.onload = function (e) {
          const text = e.target.result;
          parseCSV(text); // Parse the CSV content

          confirmationMessage.innerHTML = `File "<strong>${file.name}</strong>" uploaded successfully. Please select a date range.`;
          confirmationMessage.style.color = "green";

          // Show date range selection
          dateRangeSection.style.display = "block";
        };

        reader.readAsText(file); // Read the file content
      } else {
        confirmationMessage.innerHTML = "Please upload a valid CSV file.";
        confirmationMessage.style.color = "red";
      }
    });

    // Parse the CSV file and extract the dates from Column B
    function parseCSV(csvText) {
      const lines = csvText.split("\n");
      csvData = lines.map(line => line.split(","));
      
      // Assuming first row is the header and dates are in Column B (index 1)
      const dateColumn = csvData.slice(1).map(row => row[1]);

      // Filter out empty or invalid dates
      const validDates = dateColumn.filter(date => new Date(date) != "Invalid Date").map(date => new Date(date));

      // Find the min and max date for the date range
      const minDate = new Date(Math.min(...validDates));
      const maxDate = new Date(Math.max(...validDates));

      // Set the min and max dates in the date inputs
      startDateInput.min = minDate.toISOString().split("T")[0];
      startDateInput.max = maxDate.toISOString().split("T")[0];
      endDateInput.min = minDate.toISOString().split("T")[0];
      endDateInput.max = maxDate.toISOString().split("T")[0];
    }

    // Handle the filter button click
    filterBtn.addEventListener("click", function () {
      const startDate = new Date(startDateInput.value);
      const endDate = new Date(endDateInput.value);

      if (startDate && endDate && startDate <= endDate) {
        // Filter the data based on the selected date range
        const filteredData = csvData.filter(row => {
          const date = new Date(row[1]);
          return date >= startDate && date <= endDate;
        });

        console.log("Filtered Data:", filteredData);
        confirmationMessage.innerHTML = `Data filtered between ${startDate.toDateString()} and ${endDate.toDateString()}.`;
        confirmationMessage.style.color = "blue";
      } else {
        confirmationMessage.innerHTML = "Please select a valid date range.";
        confirmationMessage.style.color = "red";
      }
    });
  </script>
</body>
</html>
